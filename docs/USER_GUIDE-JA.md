# CrossPoint ユーザーガイド

[English](./USER_GUIDE.md) | [中文](./USER_GUIDE-ZH.md) | **[日本語](./USER_GUIDE-JA.md)**

**CrossPoint** ファームウェアへようこそ。このガイドでは、デバイスのハードウェアコントロール、ナビゲーション、読書機能について説明します。

## 1. ハードウェア概要

デバイスは Xteink X4 の標準ボタンを使用します（デフォルトでは製造元のファームウェアと同じレイアウト）：

### ボタンレイアウト
| 位置        | ボタン                                          |
| ----------- | ----------------------------------------------- |
| **底部边缘** | **戻る**、**確認**、**左**、**右**               |
| **右側**    | **電源**、**音量+**、**音量-**、**リセット**     |

ボタンレイアウトは **[設定](#35-設定)** でカスタマイズできます。

---

## 2. 電源と起動

### 電源オン / オフ

デバイスの電源をオン/オフするには、**電源ボタンを約半秒間長押し**します。
**[設定](#35-設定)** で、電源ボタンを長押しではなく短押しでオフにするように設定できます。

デバイスを再起動するには（例：フリーズした場合やファームウェア更新後）、リセットボタンを押して離し、すぐに電源ボタンを数秒間長押しします。

### 初回起動

初めてデバイスの電源を入れると、**[ホーム画面](#31-ホーム画面)** が表示されます。

> [!NOTE]
> 以降の再起動では、ファームウェアは最後に読んでいた本を自動的に開きます。

---

## 3. 画面

### 3.1 ホーム画面

ホーム画面はファームウェアのメインエントリーポイントです。ここから、最近読んだ本で **[読書モード](#4-読書モード)** に移動したり、**[書籍選択](#32-書籍選択)**、**[設定](#35-設定)**、または **[ファイルアップロード](#34-ファイルアップロード画面)** 画面に移動できます。

### 3.2 書籍選択

書籍選択はフォルダとファイルブラウザとして機能します。

* **リストのナビゲーション：** **左**（または **音量+**）、または **右**（または **音量-**）を使用して、フォルダと書籍の選択カーソルを上下に移動します。これらのボタンを長押しして、ページ全体をスクロールすることもできます。
* **選択を開く：** **確認** を押してフォルダを開くか、選択した書籍を読みます。

### 3.3 読書モード

詳細は下記の [読書モード](#4-読書モード) をご覧ください。

### 3.4 ファイルアップロード画面

ファイルアップロード画面では、デバイスに新しい電子書籍をアップロードできます。画面に入ると、WiFi 選択ダイアログが表示され、X4 が Web サーバーをホストし始めます。

Web サーバーへの接続方法とファイルのアップロード方法については、[webserver ドキュメント](./docs/webserver.md) をご覧ください。

> [!TIP]
> 上級ユーザーは、`curl` を使用してコマンドラインからプログラム的にファイルを管理することもできます。詳細は [webserver ドキュメント](./docs/webserver.md) をご覧ください。

### 3.5 設定

設定画面では、デバイスの動作を設定できます。調整できる設定は次のとおりです：
- **言語**：インターフェース言語を選択：
  - "English" - 英語インターフェース
  - "中文" - 中国語インターフェース
  - "日本語" - 日本語インターフェース
- **カラーモード**：表示カラーモードを設定：
  - "ライト"（デフォルト）- 標準のライトモード、白地に黒文字
  - "ダーク" - ダークモード、黒地に白文字、フラッシュなしの遷移
- **スリープ画面**：デバイスがスリープするときに表示する画面：
  - "ダーク"（デフォルト）- デフォルトのダーク CrossPoint ロゴスリープ画面
  - "ライト" - 同じデフォルトスリープ画面、白い背景
  - "カスタム" - SD カードからのカスタム画像；詳細は下記の [スリープ画面](#36-スリープ画面) をご覧ください
  - "カバー" - 書籍カバー画像（注：これは実験的機能で、期待どおりに動作しない場合があります）
  - "なし" - 空白画面
- **スリープ画面カバーモード**：「カバー」スリープ画面を選択したときに書籍カバーを表示する方法：
  - "フィット"（デフォルト）- 画像を縮小して画面の中央に配置し、必要に応じて白い枠で埋めます
  - "クロップ" - 画像を縮小し、必要に応じてクロップして画面を埋めようとします（注：これは実験的機能で、期待どおりに動作しない場合があります）
- **ステータスバー**：読書中に表示するステータスバーを設定：
  - "なし" - ステータスバーなし
  - "進捗なし" - 読書進捗なしでステータスバーを表示
  - "完全" - 読書進捗ありでステータスバーを表示
- **バッテリー % を非表示**：ステータスバーのバッテリーパーセンテージ表示を非表示にする場所を設定；バッテリーアイコンは引き続き表示されます：
  - "しない"（デフォルト）- 常にバッテリーパーセンテージを表示
  - "リーダー内" - 読書モード以外ではバッテリーパーセンテージを表示
  - "常に" - 常にバッテリーパーセンテージを非表示
- **追加の段落間隔**：有効にすると、書籍の段落間に垂直スペースが追加されます。無効にすると、段落間に垂直スペースはありませんが、最初の行にインデントがあります。
- **テキストアンチエイリアシング**：読書モードでテキストに滑らかな灰色のエッジ（アンチエイリアシング）を表示するかどうか。これによりページめくりが若干遅くなります。
- **短い電源ボタンクリック**：電源ボタンの短いクリックの効果を制御：
  - "無視" - デバイスをオフにするには長押しが必要
  - "スリープ" - 短押しでデバイスをオフ
  - "ページめくり" - 読書モードで短押しすると次のページに移動；長押しでデバイスをオフ
- **読書の向き**：EPUB ファイルを読むための画面の向きを設定：
  - "縦"（デフォルト）- 標準の縦向き
  - "横 CW" - 横向き、時計回りに回転
  - "反転" - 縦向き、上下逆
  - "横 CCW" - 横向き、反時計回りに回転
- **前面ボタンレイアウト**：底部エッジボタンの順序を設定：
  - 戻る、確認、左、右（デフォルト）
  - 左、右、戻る、確認
  - 左、戻る、確認、右
- **サイドボタンレイアウト（リーダー）**：音量の上下ボタンの順序を、前のページ/次のページから次のページ/前のページに入れ替えます。この変更は読書中のみ有効です。
- **長押しチャプタースキップ**：ページめくりボタンを長押ししたときに次/前のチャプターにスキップするかどうかを設定：
  - "チャプタースキップ"（デフォルト）- 長押しで次/前のチャプターにスキップ
  - "ページスクロール" - 長押しでページを上/下にスクロール
- **リーダーフォントファミリー**：読書に使用するフォントを選択：
  - "Bookerly"（デフォルト）- Amazon の読書フォント
  - "Noto Sans" - Google のサンセリフフォント
  - "Open Dyslexic" - ディスレクシアの読者向けに設計されたフォント
  - "外部フォント" - SD カード `/fonts/` ディレクトリからカスタム CJK フォントを読み込む（下記の [外部フォント](#37-外部フォント) をご覧ください）
- **リーダーフォントサイズ**：読書テキストのサイズを調整；オプションは「小」、「中」、「大」、または「特大」です。
- **リーダー行間隔**：行間隔を調整；オプションは「タイト」、「ノーマル」、または「ワイド」です。
- **リーダー画面マージン**：読書モードの画面マージンを 5 から 40 ピクセルまで、5 ピクセル単位で制御します。
- **リーダー段落配置**：段落の配置を設定；オプションは「両端揃え」（デフォルト）、「左揃え」、「中央揃え」、または「右揃え」です。
- **スリープまでの時間**：デバイスが自動的にスリープするまでの非アクティブ時間を設定します。
- **リフレッシュ頻度**：読書中にゴーストを減らすために画面が完全にリフレッシュする頻度を設定します。
- **Calibre 設定**：Calibre Web ライブラリへのアクセスまたは Calibre へのワイヤレスデバイスとしての接続の統合を設定します。
- **更新を確認**：WiFi 経由でファームウェアの更新を確認します。

### 3.6 スリープ画面

SD カードの特定の場所にカスタム画像を配置することで、スリープ画面をカスタマイズできます：

- **単一画像：** ルートディレクトリに `sleep.bmp` という名前のファイルを配置します。
- **複数画像：** SD カードのルートに `sleep` ディレクトリを作成し、任意の数の `.bmp` 画像を配置します。このディレクトリに画像が見つかった場合、`sleep.bmp` ファイルよりも優先され、デバイスがスリープするたびにランダムに 1 つが選択されます。

> [!NOTE]
> これらの画像を使用するには、**スリープ画面** 設定を **カスタム** に設定する必要があります。

> [!TIP]
> 最良の結果を得るには：
> - 24 ビットカラー深度の非圧縮 BMP ファイルを使用
> - デバイスの画面解像度に合わせて 480x800 ピクセルの解像度を使用。

### 3.7 外部フォント

SD カードからカスタム CJK（中国語、日本語、韓国語）フォントを読み込んで、非ラテン文字の読書体験を向上させることができます。

**セットアップ手順：**

1. SD カードのルートに `/fonts/` ディレクトリを作成
2. このディレクトリに `.bin` 形式のフォントファイルを配置
3. **設定** → **リーダーフォントファミリー** に移動し、**「外部フォント」** を選択

**フォントファイル形式：**

フォントファイルは次の命名規則に従う必要があります：`FontName_size_letterSpacing×lineHeight.bin`

各パラメータの意味：
- `size`：フォントサイズ（ピクセル）
- `letterSpacing`：文字間隔（ピクセル）
- `lineHeight`：行間隔（ピクセル）

例：
- `SourceHanSansCN-Medium_20_20x20.bin`（源ノ角ゴシック、20ピクセルサイズ、20ピクセル文字間隔、20ピクセル行間隔）
- `KingHwaOldSong_38_33x39.bin`（京華老宋体、38ピクセルサイズ、33ピクセル文字間隔、39ピクセル行間隔）

> [!NOTE]
> 外部フォントは Xteink 標準 `.bin` 形式を使用します。ファームウェアには、CJK レンダリングパフォーマンスを向上させるための LRU キャッシュ最適化が含まれています。

> [!TIP]
> プロジェクトリポジトリにテスト用のサンプルフォントが用意されています。

---

## 4. 読書モード

書籍を開くと、ボタンレイアウトが読書を容易にするように変更されます。

### ページめくり
| アクション    | ボタン                                |
| ------------- | ------------------------------------- |
| **前のページ** | **左** _または_ **音量+** を押す      |
| **次のページ** | **右** _または_ **音量-** を押す      |

音量（サイド）ボタンの役割は **[設定](#35-設定)** で入れ替えることができます。

**短い電源ボタンクリック** 設定が「ページめくり」に設定されている場合、電源ボタンを短く押すことで次のページに移動することもできます。

### チャプターナビゲーション
* **次のチャプター：** **右**（または **音量-**）ボタンを短時間**長押し**してから離します。
* **前のチャプター：** **左**（または **音量+**）ボタンを短時間**長押し**してから離します。

この機能は **[設定](#35-設定)** で無効にして、誤ってチャプターを変更するのを避けることができます。

### システムナビゲーション
* **書籍選択に戻る：** **戻る** を押して書籍を閉じ、**[書籍選択](#32-書籍選択)** 画面に戻ります。
* **ホームに戻る：** **戻る** ボタンを**長押し**して書籍を閉じ、**[ホーム](#31-ホーム画面)** 画面に戻ります。
* **チャプターメニュー：** **確認** を押して **[目次/チャプター選択](#5-チャプター選択画面)** を開きます。

---

## 5. チャプター選択画面

書籍内で **確認** を押すとアクセスできます。

1. **左**（または **音量+**）、または **右**（または **音量-**）を使用して、目的のチャプターをハイライトします。
2. **確認** を押してそのチャプターにジャンプします。
3. *または、**戻る** を押してキャンセルし、現在のページに戻ります。*

---

## 6. 現在の制限とロードマップ

このファームウェアは現在積極的に開発中です。以下の機能は **まだサポートされていません** が、将来の更新で追加される予定です：

* **画像：** 電子書籍に埋め込まれた画像はレンダリングされません。
