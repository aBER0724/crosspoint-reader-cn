#include "I18n.h"

#include <HardwareSerial.h>
#include <SDCardManager.h>
#include <Serialization.h>

#include <algorithm>
#include <set>
#include <string>

// Settings file path
static constexpr const char *SETTINGS_FILE = "/.crosspoint/language.bin";
static constexpr uint8_t SETTINGS_VERSION = 1;

I18n &I18n::getInstance() {
  static I18n instance;
  return instance;
}

// English strings
const char *const I18n::STRINGS_EN[] = {
    // Boot/Sleep
    "CrossPoint", "BOOTING", "SLEEPING",

    // Home Menu
    "Browse Files", "File Transfer", "Settings", "Calibre Library",
    "Continue Reading", "No open book", "Start reading below",

    // File Browser
    "Books", "No books found",

    // Reader
    "Select Chapter", "No chapters", "End of book", "Empty chapter",
    "Indexing...", "Memory error", "Page load error", "Empty file",
    "Out of bounds",

    // Network
    "WiFi Networks", "No networks found", "Scanning...", "Connecting...",
    "Connected!", "Connection Failed", "Forget Network?",
    "Save password for next time?", "Remove saved password?",
    "Press OK to scan again", "Press any button to continue",
    "LEFT/RIGHT: Select | OK: Confirm", "How would you like to connect?",
    "Join a Network", "Create Hotspot", "Connect to an existing WiFi network",
    "Create a WiFi network others can join", "Starting Hotspot...",
    "Hotspot Mode", "Connect your device to this WiFi network",
    "Open this URL in your browser",
    "or scan QR code with your phone:", "Calibre Wireless", "Calibre Web URL",
    "Connect as Wireless Device", "* = Encrypted | + = Saved", "MAC address:",

    // Settings
    "Sleep Screen", "Sleep Screen Cover Mode", "Status Bar", "Hide Battery %",
    "Extra Paragraph Spacing", "Text Anti-Aliasing", "Short Power Button Click",
    "Reading Orientation", "Front Button Layout", "Side Button Layout (reader)",
    "Long-press Chapter Skip", "Reader Font Family", "External Chinese Font",
    "External UI Font", "Reader Font Size", "Reader Line Spacing",
    "Reader Screen Margin", "Reader Paragraph Alignment", "Time to Sleep",
    "Refresh Frequency", "Calibre Settings", "Check for updates", "Language",
    "Select Wallpaper",

    // Setting Values
    "Dark", "Light", "Custom", "Cover", "None", "Fit", "Crop", "No Progress",
    "Full", "Never", "In Reader", "Always", "Ignore", "Sleep", "Page Turn",
    "Portrait", "Landscape CW", "Inverted", "Landscape CCW", "Prev/Next",
    "Next/Prev", "Bookerly", "Noto Sans", "Open Dyslexic", "Small", "Medium",
    "Large", "X Large", "Tight", "Normal", "Wide", "Justify", "Left", "Center",
    "Right", "1 min", "5 min", "10 min", "15 min", "30 min", "1 page",
    "5 pages", "10 pages", "15 pages", "30 pages",

    // OTA Update
    "Update", "Checking for update...", "New update available!",
    "Current Version: ", "New Version: ", "Updating...", "No update available",
    "Update failed", "Update complete",
    "Press and hold power button to turn back on",

    // Font Selection
    "External Font", "Built-in (Disabled)",

    // OPDS Browser
    "No entries found", "Downloading...", "Error:", "Unnamed", "Network: ",
    "IP Address: ", "or scan QR code with your phone to connect to Wifi.",

    // Buttons
    "\xC2\xAB Back", // « Back
    "\xC2\xAB Exit", // « Exit
    "\xC2\xAB Home", // « Home
    "\xC2\xAB Save", // « Save
    "Select", "Toggle", "Confirm", "Cancel", "Connect", "Open", "Retry", "Yes",
    "No", "ON", "OFF",

    // Languages
    "English",
    "\xE4\xB8\xAD\xE6\x96\x87",             // 中文
    "\xE6\x97\xA5\xE6\x9C\xAC\xE8\xAA\x9E", // 日本語
};

// Chinese strings
const char *const I18n::STRINGS_ZH[] = {
    // Boot/Sleep
    "CrossPoint",
    "\xE5\x90\xAF\xE5\x8A\xA8\xE4\xB8\xAD", // 启动中
    "\xE4\xBC\x91\xE7\x9C\xA0\xE4\xB8\xAD", // 休眠中

    // Home Menu
    "\xE6\xB5\x8F\xE8\xA7\x88\xE6\x96\x87\xE4\xBB\xB6", // 浏览文件
    "\xE6\x96\x87\xE4\xBB\xB6\xE4\xBC\xA0\xE8\xBE\x93", // 文件传输
    "\xE8\xAE\xBE\xE7\xBD\xAE",                         // 设置
    "Calibre\xE4\xB9\xA6\xE5\xBA\x93",                  // Calibre书库
    "\xE7\xBB\xA7\xE7\xBB\xAD\xE9\x98\x85\xE8\xAF\xBB", // 继续阅读
    "\xE6\x97\xA0\xE6\x89\x93\xE5\xBC\x80\xE7\x9A\x84\xE4\xB9\xA6\xE7\xB1"
    "\x8D", // 无打开的书籍
    "\xE4\xBB\x8E\xE4\xB8\x8B\xE6\x96\xB9\xE5\xBC\x80\xE5\xA7\x8B\xE9\x98"
    "\x85\xE8\xAF\xBB", // 从下方开始阅读

    // File Browser
    "\xE4\xB9\xA6\xE7\xB1\x8D",                                     // 书籍
    "\xE6\x9C\xAA\xE6\x89\xBE\xE5\x88\xB0\xE4\xB9\xA6\xE7\xB1\x8D", // 未找到书籍

    // Reader
    "\xE9\x80\x89\xE6\x8B\xA9\xE7\xAB\xA0\xE8\x8A\x82", // 选择章节
    "\xE6\x97\xA0\xE7\xAB\xA0\xE8\x8A\x82",             // 无章节
    "\xE5\xB7\xB2\xE5\x88\xB0\xE4\xB9\xA6\xE6\x9C\xAB", // 已到书末
    "\xE7\xA9\xBA\xE7\xAB\xA0\xE8\x8A\x82",             // 空章节
    "\xE7\xB4\xA2\xE5\xBC\x95\xE4\xB8\xAD...",          // 索引中...
    "\xE5\x86\x85\xE5\xAD\x98\xE9\x94\x99\xE8\xAF\xAF", // 内存错误
    "\xE9\xA1\xB5\xE9\x9D\xA2\xE5\x8A\xA0\xE8\xBD\xBD\xE9\x94\x99\xE8\xAF"
    "\xAF",                                             // 页面加载错误
    "\xE7\xA9\xBA\xE6\x96\x87\xE4\xBB\xB6",             // 空文件
    "\xE8\xB6\x85\xE5\x87\xBA\xE8\x8C\x83\xE5\x9B\xB4", // 超出范围

    // Network
    "WiFi\xE7\xBD\x91\xE7\xBB\x9C",                                 // WiFi网络
    "\xE6\x9C\xAA\xE6\x89\xBE\xE5\x88\xB0\xE7\xBD\x91\xE7\xBB\x9C", // 未找到网络
    "\xE6\x89\xAB\xE6\x8F\x8F\xE4\xB8\xAD...",                      // 扫描中...
    "\xE8\xBF\x9E\xE6\x8E\xA5\xE4\xB8\xAD...",                      // 连接中...
    "\xE5\xB7\xB2\xE8\xBF\x9E\xE6\x8E\xA5!",                        // 已连接!
    "\xE8\xBF\x9E\xE6\x8E\xA5\xE5\xA4\xB1\xE8\xB4\xA5",             // 连接失败
    "\xE5\xBF\x98\xE8\xAE\xB0\xE7\xBD\x91\xE7\xBB\x9C?",            // 忘记网络?
    "\xE4\xBF\x9D\xE5\xAD\x98\xE5\xAF\x86\xE7\xA0\x81?",            // 保存密码?
    "\xE5\x88\xA0\xE9\x99\xA4\xE5\xB7\xB2\xE4\xBF\x9D\xE5\xAD\x98\xE5\xAF"
    "\x86\xE7\xA0\x81?", // 删除已保存密码?
    "\xE6\x8C\x89\xE7\xA1\xAE\xE5\xAE\x9A\xE9\x87\x8D\xE6\x96\xB0\xE6\x89"
    "\xAB\xE6\x8F\x8F", // 按确定重新扫描
    "\xE6\x8C\x89\xE4\xBB\xBB\xE6\x84\x8F\xE9\x94\xAE\xE7\xBB\xA7\xE7\xBB"
    "\xAD", // 按任意键继续
    "\xE5\xB7\xA6/\xE5\x8F\xB3:\xE9\x80\x89\xE6\x8B\xA9 | "
    "\xE7\xA1\xAE\xE5\xAE\x9A:\xE7\xA1\xAE\xE8\xAE\xA4", // 左/右:选择 |
                                                         // 确定:确认
    "\xE9\x80\x89\xE6\x8B\xA9\xE8\xBF\x9E\xE6\x8E\xA5\xE6\x96\xB9\xE5\xBC"
    "\x8F",                                             // 选择连接方式
    "\xE5\x8A\xA0\xE5\x85\xA5\xE7\xBD\x91\xE7\xBB\x9C", // 加入网络
    "\xE5\x88\x9B\xE5\xBB\xBA\xE7\x83\xAD\xE7\x82\xB9", // 创建热点
    "\xE8\xBF\x9E\xE6\x8E\xA5\xE5\x88\xB0\xE7\x8E\xB0\xE6\x9C\x89WiFi\xE7"
    "\xBD\x91\xE7\xBB\x9C", // 连接到现有WiFi网络
    "\xE5\x88\x9B\xE5\xBB\xBAWiFi\xE7\xBD\x91\xE7\xBB\x9C\xE4\xBE\x9B\xE4"
    "\xBB\x96\xE4\xBA\xBA\xE8\xBF\x9E\xE6\x8E\xA5", // 创建WiFi网络供他人连接
    "\xE5\x90\xAF\xE5\x8A\xA8\xE7\x83\xAD\xE7\x82\xB9\xE4\xB8\xAD...", // 启动热点中...
    "\xE7\x83\xAD\xE7\x82\xB9\xE6\xA8\xA1\xE5\xBC\x8F", // 热点模式
    "\xE5\xB0\x86\xE8\xAE\xBE\xE5\xA4\x87\xE8\xBF\x9E\xE6\x8E\xA5\xE5\x88"
    "\xB0\xE6\xAD\xA4WiFi", // 将设备连接到此WiFi
    "\xE5\x9C\xA8\xE6\xB5\x8F\xE8\xA7\x88\xE5\x99\xA8\xE4\xB8\xAD\xE6\x89"
    "\x93\xE5\xBC\x80\xE6\xAD\xA4URL", // 在浏览器中打开此URL
    "\xE6\x88\x96\xE7\x94\xA8\xE6\x89\x8B\xE6\x9C\xBA\xE6\x89\xAB\xE6\x8F"
    "\x8F\xE4\xBA\x8C\xE7\xBB\xB4\xE7\xA0\x81:", // 或用手机扫描二维码:
    "Calibre\xE6\x97\xA0\xE7\xBA\xBF\xE8\xBF\x9E\xE6\x8E\xA5", // Calibre无线连接
    "Calibre Web\xE5\x9C\xB0\xE5\x9D\x80", // Calibre Web地址
    "\xE4\xBD\x9C\xE4\xB8\xBA\xE6\x97\xA0\xE7\xBA\xBF\xE8\xAE\xBE\xE5\xA4"
    "\x87\xE8\xBF\x9E\xE6\x8E\xA5", // 作为无线设备连接
    "* = \xE5\x8A\xA0\xE5\xAF\x86 | + = "
    "\xE5\xB7\xB2\xE4\xBF\x9D\xE5\xAD\x98", // * = 加密 | + = 已保存
    "MAC\xE5\x9C\xB0\xE5\x9D\x80:",         // MAC地址:

    // Settings
    "\xE4\xBC\x91\xE7\x9C\xA0\xE5\xB1\x8F\xE5\xB9\x95", // 休眠屏幕
    "\xE5\xB0\x81\xE9\x9D\xA2\xE6\x98\xBE\xE7\xA4\xBA\xE6\xA8\xA1\xE5\xBC"
    "\x8F",                                 // 封面显示模式
    "\xE7\x8A\xB6\xE6\x80\x81\xE6\xA0\x8F", // 状态栏
    "\xE9\x9A\x90\xE8\x97\x8F\xE7\x94\xB5\xE9\x87\x8F\xE7\x99\xBE\xE5\x88"
    "\x86\xE6\xAF\x94", // 隐藏电量百分比
    "\xE6\xAE\xB5\xE8\x90\xBD\xE9\xA2\x9D\xE5\xA4\x96\xE9\x97\xB4\xE8\xB7"
    "\x9D", // 段落额外间距
    "\xE6\x96\x87\xE5\xAD\x97\xE6\x8A\x97\xE9\x94\xAF\xE9\xBD\xBF", // 文字抗锯齿
    "\xE7\x94\xB5\xE6\xBA\x90\xE9\x94\xAE\xE7\x9F\xAD\xE6\x8C\x89", // 电源键短按
    "\xE9\x98\x85\xE8\xAF\xBB\xE6\x96\xB9\xE5\x90\x91",             // 阅读方向
    "\xE5\x89\x8D\xE7\xBD\xAE\xE6\x8C\x89\xE9\x92\xAE\xE5\xB8\x83\xE5\xB1"
    "\x80", // 前置按钮布局
    "\xE4\xBE\xA7\xE8\xBE\xB9\xE6\x8C\x89\xE9\x92\xAE\xE5\xB8\x83\xE5\xB1"
    "\x80", // 侧边按钮布局
    "\xE9\x95\xBF\xE6\x8C\x89\xE8\xB7\xB3\xE8\xBD\xAC\xE7\xAB\xA0\xE8\x8A"
    "\x82",                                             // 长按跳转章节
    "\xE9\x98\x85\xE8\xAF\xBB\xE5\xAD\x97\xE4\xBD\x93", // 阅读字体
    "\xE9\x98\x85\xE8\xAF\xBB\xE5\x99\xA8\xE5\xAD\x97\xE4\xBD\x93", // 阅读器字体
    "UI\xE5\xAD\x97\xE4\xBD\x93",                                   // UI字体
    "\xE5\xAD\x97\xE4\xBD\x93\xE5\xA4\xA7\xE5\xB0\x8F",             // 字体大小
    "\xE8\xA1\x8C\xE9\x97\xB4\xE8\xB7\x9D",                         // 行间距
    "\xE9\xA1\xB5\xE9\x9D\xA2\xE8\xBE\xB9\xE8\xB7\x9D",             // 页面边距
    "\xE6\xAE\xB5\xE8\x90\xBD\xE5\xAF\xB9\xE9\xBD\x90",             // 段落对齐
    "\xE4\xBC\x91\xE7\x9C\xA0\xE6\x97\xB6\xE9\x97\xB4",             // 休眠时间
    "\xE5\x88\xB7\xE6\x96\xB0\xE9\xA2\x91\xE7\x8E\x87",             // 刷新频率
    "Calibre\xE8\xAE\xBE\xE7\xBD\xAE",                  // Calibre设置
    "\xE6\xA3\x80\xE6\x9F\xA5\xE6\x9B\xB4\xE6\x96\xB0", // 检查更新
    "\xE8\xAF\xAD\xE8\xA8\x80",                         // 语言
    "\xE9\x80\x89\xE6\x8B\xA9\xE5\xA3\x81\xE7\xBA\xB8", // 选择壁纸

    // Setting Values
    "\xE6\xB7\xB1\xE8\x89\xB2",                                     // 深色
    "\xE6\xB5\x85\xE8\x89\xB2",                                     // 浅色
    "\xE8\x87\xAA\xE5\xAE\x9A\xE4\xB9\x89",                         // 自定义
    "\xE5\xB0\x81\xE9\x9D\xA2",                                     // 封面
    "\xE6\x97\xA0",                                                 // 无
    "\xE9\x80\x82\xE5\xBA\x94",                                     // 适应
    "\xE8\xA3\x81\xE5\x89\xAA",                                     // 裁剪
    "\xE6\x97\xA0\xE8\xBF\x9B\xE5\xBA\xA6",                         // 无进度
    "\xE5\xAE\x8C\xE6\x95\xB4",                                     // 完整
    "\xE4\xBB\x8E\xE4\xB8\x8D",                                     // 从不
    "\xE9\x98\x85\xE8\xAF\xBB\xE6\x97\xB6",                         // 阅读时
    "\xE5\xA7\x8B\xE7\xBB\x88",                                     // 始终
    "\xE5\xBF\xBD\xE7\x95\xA5",                                     // 忽略
    "\xE4\xBC\x91\xE7\x9C\xA0",                                     // 休眠
    "\xE7\xBF\xBB\xE9\xA1\xB5",                                     // 翻页
    "\xE7\xAB\x96\xE5\xB1\x8F",                                     // 竖屏
    "\xE6\xA8\xAA\xE5\xB1\x8F\xE9\xA1\xBA\xE6\x97\xB6\xE9\x92\x88", // 横屏顺时针
    "\xE5\x80\x92\xE7\xBD\xAE",                                     // 倒置
    "\xE6\xA8\xAA\xE5\xB1\x8F\xE9\x80\x86\xE6\x97\xB6\xE9\x92\x88", // 横屏逆时针
    "\xE4\xB8\x8A\xE4\xB8\x80\xE9\xA1\xB5/"
    "\xE4\xB8\x8B\xE4\xB8\x80\xE9\xA1\xB5", // 上一页/下一页
    "\xE4\xB8\x8B\xE4\xB8\x80\xE9\xA1\xB5/"
    "\xE4\xB8\x8A\xE4\xB8\x80\xE9\xA1\xB5", // 下一页/上一页
    "Bookerly", "Noto Sans", "Open Dyslexic",
    "\xE5\xB0\x8F",                                     // 小
    "\xE4\xB8\xAD",                                     // 中
    "\xE5\xA4\xA7",                                     // 大
    "\xE7\x89\xB9\xE5\xA4\xA7",                         // 特大
    "\xE7\xB4\xA7\xE5\x87\x91",                         // 紧凑
    "\xE6\xAD\xA3\xE5\xB8\xB8",                         // 正常
    "\xE5\xAE\xBD\xE6\x9D\xBE",                         // 宽松
    "\xE4\xB8\xA4\xE7\xAB\xAF\xE5\xAF\xB9\xE9\xBD\x90", // 两端对齐
    "\xE5\xB7\xA6\xE5\xAF\xB9\xE9\xBD\x90",             // 左对齐
    "\xE5\xB1\x85\xE4\xB8\xAD",                         // 居中
    "\xE5\x8F\xB3\xE5\xAF\xB9\xE9\xBD\x90",             // 右对齐
    "1\xE5\x88\x86\xE9\x92\x9F",                        // 1分钟
    "5\xE5\x88\x86\xE9\x92\x9F",                        // 5分钟
    "10\xE5\x88\x86\xE9\x92\x9F",                       // 10分钟
    "15\xE5\x88\x86\xE9\x92\x9F",                       // 15分钟
    "30\xE5\x88\x86\xE9\x92\x9F",                       // 30分钟
    "1\xE9\xA1\xB5",                                    // 1页
    "5\xE9\xA1\xB5",                                    // 5页
    "10\xE9\xA1\xB5",                                   // 10页
    "15\xE9\xA1\xB5",                                   // 15页
    "30\xE9\xA1\xB5",                                   // 30页

    // OTA Update
    "\xE6\x9B\xB4\xE6\x96\xB0",                                        // 更新
    "\xE6\xA3\x80\xE6\x9F\xA5\xE6\x9B\xB4\xE6\x96\xB0\xE4\xB8\xAD...", // 检查更新中...
    "\xE6\x9C\x89\xE6\x96\xB0\xE7\x89\x88\xE6\x9C\xAC\xE5\x8F\xAF\xE7\x94"
    "\xA8!",                                              // 有新版本可用!
    "\xE5\xBD\x93\xE5\x89\x8D\xE7\x89\x88\xE6\x9C\xAC: ", // 当前版本:
    "\xE6\x96\xB0\xE7\x89\x88\xE6\x9C\xAC: ",             // 新版本:
    "\xE6\x9B\xB4\xE6\x96\xB0\xE4\xB8\xAD...",            // 更新中...
    "\xE5\xB7\xB2\xE6\x98\xAF\xE6\x9C\x80\xE6\x96\xB0\xE7\x89\x88\xE6\x9C"
    "\xAC",                                             // 已是最新版本
    "\xE6\x9B\xB4\xE6\x96\xB0\xE5\xA4\xB1\xE8\xB4\xA5", // 更新失败
    "\xE6\x9B\xB4\xE6\x96\xB0\xE5\xAE\x8C\xE6\x88\x90", // 更新完成
    "\xE9\x95\xBF\xE6\x8C\x89\xE7\x94\xB5\xE6\xBA\x90\xE9\x94\xAE\xE5\xBC"
    "\x80\xE6\x9C\xBA", // 长按电源键开机

    // Font Selection
    "\xE5\xA4\x96\xE7\xBD\xAE\xE5\xAD\x97\xE4\xBD\x93", // 外置字体
    "\xE5\x86\x85\xE7\xBD\xAE(\xE5\xB7\xB2\xE7\xA6\x81\xE7\x94\xA8)", // 内置(已禁用)

    // OPDS Browser
    "\xE6\x97\xA0\xE6\x9D\xA1\xE7\x9B\xAE",    // 无条目
    "\xE4\xB8\x8B\xE8\xBD\xBD\xE4\xB8\xAD...", // 下载中...
    "\xE9\x94\x99\xE8\xAF\xAF:",               // 错误:
    "\xE6\x9C\xAA\xE5\x91\xBD\xE5\x90\x8D",    // 未命名
    "\xE7\xBD\x91\xE7\xBB\x9C: ",              // 网络:
    "IP\xE5\x9C\xB0\xE5\x9D\x80: ",            // IP地址:
    "\xE6\x88\x96\xE7\x94\xA8\xE6\x89\x8B\xE6\x9C\xBA\xE6\x89\xAB\xE6\x8F\x8F"
    "\xE4\xBA\x8C\xE7\xBB\xB4\xE7\xA0\x81\xE8\xBF\x9E\xE6\x8E\xA5WiFi", // 或用手机扫描二维码连接WiFi

    // Buttons
    "\xC2\xAB \xE8\xBF\x94\xE5\x9B\x9E", // « 返回
    "\xC2\xAB \xE9\x80\x80\xE5\x87\xBA", // « 退出
    "\xC2\xAB \xE4\xB8\xBB\xE9\xA1\xB5", // « 主页
    "\xC2\xAB \xE4\xBF\x9D\xE5\xAD\x98", // « 保存
    "\xE9\x80\x89\xE6\x8B\xA9",          // 选择
    "\xE5\x88\x87\xE6\x8D\xA2",          // 切换
    "\xE7\xA1\xAE\xE5\xAE\x9A",          // 确定
    "\xE5\x8F\x96\xE6\xB6\x88",          // 取消
    "\xE8\xBF\x9E\xE6\x8E\xA5",          // 连接
    "\xE6\x89\x93\xE5\xBC\x80",          // 打开
    "\xE9\x87\x8D\xE8\xAF\x95",          // 重试
    "\xE6\x98\xAF",                      // 是
    "\xE5\x90\xA6",                      // 否
    "\xE5\xBC\x80",                      // 开
    "\xE5\x85\xB3",                      // 关

    // Languages
    "English",
    "\xE4\xB8\xAD\xE6\x96\x87",             // 中文
    "\xE6\x97\xA5\xE6\x9C\xAC\xE8\xAA\x9E", // 日本語
};

// Japanese strings
const char *const I18n::STRINGS_JA[] = {
    // Boot/Sleep
    "CrossPoint",
    "\xE8\xB5\xB7\xE5\x8B\x95\xE4\xB8\xAD",                         // 起動中
    "\xE3\x82\xB9\xE3\x83\xAA\xE3\x83\xBC\xE3\x83\x97\xE4\xB8\xAD", // スリープ中

    // Home Menu
    "\xE3\x83\x95\xE3\x82\xA1\xE3\x82\xA4\xE3\x83\xAB\xE4\xB8\x80\xE8"
    "\xA6"
    "\xA7", // ファイル一覧
    "\xE3\x83\x95\xE3\x82\xA1\xE3\x82\xA4\xE3\x83\xAB\xE8\xBB\xA2\xE9"
    "\x80"
    "\x81",                     // ファイル転送
    "\xE8\xA8\xAD\xE5\xAE\x9A", // 設定
    "Calibre\xE3\x83\xA9\xE3\x82\xA4\xE3\x83\x96\xE3\x83\xA9\xE3\x83"
    "\xAA", // Calibreライブラリ
    "\xE7\xB6\x9A\xE3\x81\x8D\xE3\x82\x92\xE8\xAA\xAD\xE3\x82\x80", // 続きを読む
    "\xE9\x96\x8B\xE3\x81\x84\xE3\x81\xA6\xE3\x81\x84\xE3\x82\x8B\xE6"
    "\x9C"
    "\xAC\xE3\x81\xAF\xE3\x81\x82\xE3\x82\x8A\xE3\x81\xBE\xE3\x81\x9B"
    "\xE3"
    "\x82\x93", // 開いている本はありません
    "\xE4\xB8\x8B\xE3\x81\x8B\xE3\x82\x89\xE8\xAA\xAD\xE6\x9B\xB8\xE3"
    "\x82"
    "\x92\xE5\xA7\x8B\xE3\x82\x81\xE3\x82\x8B", // 下から読書を始める

    // File Browser
    "\xE6\x9C\xAC", // 本
    "\xE6\x9C\xAC\xE3\x81\x8C\xE8\xA6\x8B\xE3\x81\xA4\xE3\x81\x8B\xE3"
    "\x82"
    "\x8A\xE3\x81\xBE\xE3\x81\x9B\xE3\x82\x93", // 本が見つかりません

    // Reader
    "\xE7\xAB\xA0\xE3\x82\x92\xE9\x81\xB8\xE6\x8A\x9E",             // 章を選択
    "\xE7\xAB\xA0\xE3\x81\xAA\xE3\x81\x97",                         // 章なし
    "\xE6\x9C\xAC\xE3\x81\xAE\xE7\xB5\x82\xE3\x82\x8F\xE3\x82\x8A", // 本の終わり
    "\xE7\xA9\xBA\xE3\x81\xAE\xE7\xAB\xA0",                         // 空の章
    "\xE3\x82\xA4\xE3\x83\xB3\xE3\x83\x87\xE3\x83\x83\xE3\x82\xAF\xE3"
    "\x82"
    "\xB9\xE4\xB8\xAD...", // インデックス中...
    "\xE3\x83\xA1\xE3\x83\xA2\xE3\x83\xAA\xE3\x82\xA8\xE3\x83\xA9\xE3"
    "\x83"
    "\xBC", // メモリエラー
    "\xE3\x83\x9A\xE3\x83\xBC\xE3\x82\xB8\xE8\xAA\xAD\xE3\x81\xBF\xE8"
    "\xBE"
    "\xBC\xE3\x81\xBF\xE3\x82\xA8\xE3\x83\xA9\xE3\x83\xBC", // ページ読み込みエラー
    "\xE7\xA9\xBA\xE3\x81\xAE\xE3\x83\x95\xE3\x82\xA1\xE3\x82\xA4\xE3"
    "\x83"
    "\xAB",                                 // 空のファイル
    "\xE7\xAF\x84\xE5\x9B\xB2\xE5\xA4\x96", // 範囲外

    // Network
    "WiFi\xE3\x83\x8D\xE3\x83\x83\xE3\x83\x88\xE3\x83\xAF\xE3\x83\xBC"
    "\xE3"
    "\x82\xAF", // WiFiネットワーク
    "\xE3\x83\x8D\xE3\x83\x83\xE3\x83\x88\xE3\x83\xAF\xE3\x83\xBC\xE3"
    "\x82"
    "\xAF\xE3\x81\x8C\xE8\xA6\x8B\xE3\x81\xA4\xE3\x81\x8B\xE3\x82\x8A"
    "\xE3"
    "\x81\xBE\xE3\x81\x9B\xE3\x82\x93", // ネットワークが見つかりません
    "\xE3\x82\xB9\xE3\x82\xAD\xE3\x83\xA3\xE3\x83\xB3\xE4\xB8\xAD...", // スキャン中...
    "\xE6\x8E\xA5\xE7\xB6\x9A\xE4\xB8\xAD...",           // 接続中...
    "\xE6\x8E\xA5\xE7\xB6\x9A\xE5\xAE\x8C\xE4\xBA\x86!", // 接続完了!
    "\xE6\x8E\xA5\xE7\xB6\x9A\xE5\xA4\xB1\xE6\x95\x97",  // 接続失敗
    "\xE3\x83\x8D\xE3\x83\x83\xE3\x83\x88\xE3\x83\xAF\xE3\x83\xBC\xE3"
    "\x82"
    "\xAF\xE3\x82\x92\xE5\xBF\x98\xE3\x82\x8C\xE3\x82\x8B?", // ネットワークを忘れる?
    "\xE3\x83\x91\xE3\x82\xB9\xE3\x83\xAF\xE3\x83\xBC\xE3\x83\x89\xE3"
    "\x82"
    "\x92\xE4\xBF\x9D\xE5\xAD\x98?", // パスワードを保存?
    "\xE4\xBF\x9D\xE5\xAD\x98\xE3\x81\x97\xE3\x81\x9F\xE3\x83\x91\xE3"
    "\x82"
    "\xB9\xE3\x83\xAF\xE3\x83\xBC\xE3\x83\x89\xE3\x82\x92\xE5\x89\x8A"
    "\xE9"
    "\x99\xA4?", // 保存したパスワードを削除?
    "OK\xE3\x82\x92\xE6\x8A\xBC\xE3\x81\x97\xE3\x81\xA6\xE5\x86\x8D\xE3"
    "\x82"
    "\xB9\xE3\x82\xAD\xE3\x83\xA3\xE3\x83\xB3", // OKを押して再スキャン
    "\xE4\xBB\xBB\xE6\x84\x8F\xE3\x81\xAE\xE3\x83\x9C\xE3\x82\xBF\xE3"
    "\x83"
    "\xB3\xE3\x82\x92\xE6\x8A\xBC\xE3\x81\x97\xE3\x81\xA6\xE7\xB6\x9A"
    "\xE8"
    "\xA1\x8C", // 任意のボタンを押して続行
    "\xE5\xB7\xA6/\xE5\x8F\xB3:\xE9\x81\xB8\xE6\x8A\x9E | "
    "OK:\xE7\xA1\xBA\xE8\xAA\x8D", // 左/右:選択 | OK:確認
    "\xE6\x8E\xA5\xE7\xB6\x9A\xE6\x96\xB9\xE6\xB3\x95\xE3\x82\x92\xE9"
    "\x81"
    "\xB8\xE6\x8A\x9E", // 接続方法を選択
    "\xE3\x83\x8D\xE3\x83\x83\xE3\x83\x88\xE3\x83\xAF\xE3\x83\xBC\xE3"
    "\x82"
    "\xAF\xE3\x81\xAB\xE5\x8F\x82\xE5\x8A\xA0", // ネットワークに参加
    "\xE3\x83\x9B\xE3\x83\x83\xE3\x83\x88\xE3\x82\xB9\xE3\x83\x9D\xE3"
    "\x83"
    "\x83\xE3\x83\x88\xE3\x82\x92\xE4\xBD\x9C\xE6\x88\x90", // ホットスポットを作成
    "\xE6\x97\xA2\xE5\xAD\x98\xE3\x81\xAEWiFi\xE3\x81\xAB\xE6\x8E\xA5"
    "\xE7"
    "\xB6\x9A", // 既存のWiFiに接続
    "WiFi\xE3\x82\x92\xE4\xBD\x9C\xE6\x88\x90\xE3\x81\x97\xE3\x81\xA6"
    "\xE4"
    "\xBB\x96\xE3\x81\xAE\xE4\xBA\xBA\xE3\x81\x8C\xE6\x8E\xA5\xE7\xB6"
    "\x9A", // WiFiを作成して他の人が接続
    "\xE3\x83\x9B\xE3\x83\x83\xE3\x83\x88\xE3\x82\xB9\xE3\x83\x9D\xE3"
    "\x83"
    "\x83\xE3\x83\x88\xE3\x82\x92\xE8\xB5\xB7\xE5\x8B\x95\xE4\xB8\xAD.."
    ".", // ホットスポットを起動中...
    "\xE3\x83\x9B\xE3\x83\x83\xE3\x83\x88\xE3\x82\xB9\xE3\x83\x9D\xE3"
    "\x83"
    "\x83\xE3\x83\x88\xE3\x83\xA2\xE3\x83\xBC\xE3\x83\x89", // ホットスポットモード
    "\xE3\x81\x93\xE3\x81\xAEWiFi\xE3\x81\xAB\xE3\x83\x87\xE3\x83\x90"
    "\xE3"
    "\x82\xA4\xE3\x82\xB9\xE3\x82\x92\xE6\x8E\xA5\xE7\xB6\x9A", // このWiFiにデバイスを接続
    "\xE3\x83\x96\xE3\x83\xA9\xE3\x82\xA6\xE3\x82\xB6\xE3\x81\xA7\xE3"
    "\x81"
    "\x93\xE3\x81\xAEURL\xE3\x82\x92\xE9\x96\x8B\xE3\x81\x8F", // ブラウザでこのURLを開く
    "\xE3\x82\xB9\xE3\x83\x9E\xE3\x83\x9B\xE3\x81\xA7QR\xE3\x82\xB3\xE3"
    "\x83"
    "\xBC\xE3\x83\x89\xE3\x82\x92\xE3\x82\xB9\xE3\x82\xAD\xE3\x83\xA3"
    "\xE3"
    "\x83\xB3:", // スマホでQRコードをスキャン:
    "Calibre\xE3\x83\xAF\xE3\x82\xA4\xE3\x83\xA4\xE3\x83\xAC\xE3\x82"
    "\xB9", // Calibreワイヤレス
    "Calibre Web URL",
    "\xE3\x83\xAF\xE3\x82\xA4\xE3\x83\xA4\xE3\x83\xAC\xE3\x82\xB9\xE3"
    "\x83"
    "\x87\xE3\x83\x90\xE3\x82\xA4\xE3\x82\xB9\xE3\x81\xA8\xE3\x81\x97"
    "\xE3"
    "\x81\xA6\xE6\x8E\xA5\xE7\xB6\x9A", // ワイヤレスデバイスとして接続
    "* = \xE6\x9A\x97\xE5\x8F\xB7\xE5\x8C\x96 | + = "
    "\xE4\xBF\x9D\xE5\xAD\x98\xE6\xB8\x88\xE3\x81\xBF",     // * = 暗号化 |
                                                            // + = 保存済み
    "MAC\xE3\x82\xA2\xE3\x83\x89\xE3\x83\xAC\xE3\x82\xB9:", // MACアドレス:

    // Settings
    "\xE3\x82\xB9\xE3\x83\xAA\xE3\x83\xBC\xE3\x83\x97\xE7\x94\xBB\xE9"
    "\x9D"
    "\xA2", // スリープ画面
    "\xE3\x82\xB9\xE3\x83\xAA\xE3\x83\xBC\xE3\x83\x97\xE7\x94\xBB\xE9"
    "\x9D"
    "\xA2\xE3\x82\xAB\xE3\x83\x90\xE3\x83\xBC\xE3\x83\xA2\xE3\x83\xBC"
    "\xE3"
    "\x83\x89", // スリープ画面カバーモード
    "\xE3\x82\xB9\xE3\x83\x86\xE3\x83\xBC\xE3\x82\xBF\xE3\x82\xB9\xE3"
    "\x83"
    "\x90\xE3\x83\xBC", // ステータスバー
    "\xE3\x83\x90\xE3\x83\x83\xE3\x83\x86\xE3\x83\xAA\xE3\x83\xBC%"
    "\xE3\x82\x92\xE9\x9A\xA0\xE3\x81\x99", // バッテリー%を隠す
    "\xE6\xAE\xB5\xE8\x90\xBD\xE8\xBF\xBD\xE5\x8A\xA0\xE9\x96\x93\xE9"
    "\x9A"
    "\x94", // 段落追加間隔
    "\xE3\x83\x86\xE3\x82\xAD\xE3\x82\xB9\xE3\x83\x88\xE3\x82\xA2\xE3"
    "\x83"
    "\xB3\xE3\x83\x81\xE3\x82\xA8\xE3\x82\xA4\xE3\x83\xAA\xE3\x82\xA2"
    "\xE3"
    "\x82\xB9", // テキストアンチエイリアス
    "\xE9\x9B\xBB\xE6\xBA\x90\xE3\x83\x9C\xE3\x82\xBF\xE3\x83\xB3\xE7"
    "\x9F"
    "\xAD\xE6\x8A\xBC\xE3\x81\x97",                     // 電源ボタン短押し
    "\xE8\xAA\xAD\xE6\x9B\xB8\xE6\x96\xB9\xE5\x90\x91", // 読書方向
    "\xE5\x89\x8D\xE9\x9D\xA2\xE3\x83\x9C\xE3\x82\xBF\xE3\x83\xB3\xE9"
    "\x85"
    "\x8D\xE7\xBD\xAE", // 前面ボタン配置
    "\xE5\x81\xB4\xE9\x9D\xA2\xE3\x83\x9C\xE3\x82\xBF\xE3\x83\xB3\xE9"
    "\x85"
    "\x8D\xE7\xBD\xAE", // 側面ボタン配置
    "\xE9\x95\xB7\xE6\x8A\xBC\xE3\x81\x97\xE7\xAB\xA0\xE3\x82\xB9\xE3"
    "\x82"
    "\xAD\xE3\x83\x83\xE3\x83\x97", // 長押し章スキップ
    "\xE3\x83\x95\xE3\x82\xA9\xE3\x83\xB3\xE3\x83\x88\xE3\x83\x95\xE3"
    "\x82"
    "\xA1\xE3\x83\x9F\xE3\x83\xAA\xE3\x83\xBC", // フォントファミリー
    "\xE3\x83\xAA\xE3\x83\xBC\xE3\x83\x80\xE3\x83\xBC\xE3\x83\x95\xE3"
    "\x82\xA9"
    "\xE3\x83\xB3\xE3\x83\x88",                           // リーダーフォント
    "UI\xE3\x83\x95\xE3\x82\xA9\xE3\x83\xB3\xE3\x83\x88", // UIフォント
    "\xE3\x83\x95\xE3\x82\xA9\xE3\x83\xB3\xE3\x83\x88\xE3\x82\xB5\xE3"
    "\x82"
    "\xA4\xE3\x82\xB9",                                 // フォントサイズ
    "\xE8\xA1\x8C\xE9\x96\x93\xE9\x9A\x94",             // 行間隔
    "\xE7\x94\xBB\xE9\x9D\xA2\xE4\xBD\x99\xE7\x99\xBD", // 画面余白
    "\xE6\xAE\xB5\xE8\x90\xBD\xE9\x85\x8D\xE7\xBD\xAE", // 段落配置
    "\xE3\x82\xB9\xE3\x83\xAA\xE3\x83\xBC\xE3\x83\x97\xE3\x81\xBE\xE3"
    "\x81"
    "\xA7\xE3\x81\xAE\xE6\x99\x82\xE9\x96\x93", // スリープまでの時間
    "\xE3\x83\xAA\xE3\x83\x95\xE3\x83\xAC\xE3\x83\x83\xE3\x82\xB7\xE3"
    "\x83"
    "\xA5\xE9\xA0\xBB\xE5\xBA\xA6",    // リフレッシュ頻度
    "Calibre\xE8\xA8\xAD\xE5\xAE\x9A", // Calibre設定
    "\xE3\x82\xA2\xE3\x83\x83\xE3\x83\x97\xE3\x83\x87\xE3\x83\xBC\xE3"
    "\x83"
    "\x88\xE3\x82\x92\xE7\xA2\xBA\xE8\xAA\x8D", // アップデートを確認
    "\xE8\xA8\x80\xE8\xAA\x9E",                 // 言語
    "\xE5\xA3\x81\xE7\ paper\xE3\x82\x92\xE9\x81\xB8\xE6\x8A\x9E", // 壁紙を選択

    // Setting Values
    "\xE3\x83\x80\xE3\x83\xBC\xE3\x82\xAF",             // ダーク
    "\xE3\x83\xA9\xE3\x82\xA4\xE3\x83\x88",             // ライト
    "\xE3\x82\xAB\xE3\x82\xB9\xE3\x82\xBF\xE3\x83\xA0", // カスタム
    "\xE3\x82\xAB\xE3\x83\x90\xE3\x83\xBC",             // カバー
    "\xE3\x81\xAA\xE3\x81\x97",                         // なし
    "\xE3\x83\x95\xE3\x82\xA3\xE3\x83\x83\xE3\x83\x88", // フィット
    "\xE3\x82\xAF\xE3\x83\xAD\xE3\x83\x83\xE3\x83\x97", // クロップ
    "\xE9\x80\xB2\xE6\x8D\x97\xE3\x81\xAA\xE3\x81\x97", // 進捗なし
    "\xE3\x83\x95\xE3\x83\xAB",                         // フル
    "\xE3\x81\x97\xE3\x81\xAA\xE3\x81\x84",             // しない
    "\xE8\xAA\xAD\xE6\x9B\xB8\xE4\xB8\xAD",             // 読書中
    "\xE5\xB8\xB8\xE3\x81\xAB",                         // 常に
    "\xE7\x84\xA1\xE8\xA6\x96",                         // 無視
    "\xE3\x82\xB9\xE3\x83\xAA\xE3\x83\xBC\xE3\x83\x97", // スリープ
    "\xE3\x83\x9A\xE3\x83\xBC\xE3\x82\xB8\xE3\x82\x81\xE3\x81\x8F\xE3"
    "\x82"
    "\x8A",                                 // ページめくり
    "\xE7\xB8\xA6\xE5\x90\x91\xE3\x81\x8D", // 縦向き
    "\xE6\xA8\xAA\xE5\x90\x91\xE3\x81\x8D\xE6\x99\x82\xE8\xA8\x88\xE5"
    "\x9B"
    "\x9E\xE3\x82\x8A",         // 横向き時計回り
    "\xE5\x8F\x8D\xE8\xBB\xA2", // 反転
    "\xE6\xA8\xAA\xE5\x90\x91\xE3\x81\x8D\xE5\x8F\x8D\xE6\x99\x82\xE8"
    "\xA8"
    "\x88\xE5\x9B\x9E\xE3\x82\x8A", // 横向き反時計回り
    "\xE5\x89\x8D/\xE6\xAC\xA1",    // 前/次
    "\xE6\xAC\xA1/\xE5\x89\x8D",    // 次/前
    "Bookerly", "Noto Sans", "Open Dyslexic",
    "\xE5\xB0\x8F",                                     // 小
    "\xE4\xB8\xAD",                                     // 中
    "\xE5\xA4\xA7",                                     // 大
    "\xE7\x89\xB9\xE5\xA4\xA7",                         // 特大
    "\xE7\x8B\xAD\xE3\x81\x84",                         // 狭い
    "\xE6\x99\xAE\xE9\x80\x9A",                         // 普通
    "\xE5\xBA\x83\xE3\x81\x84",                         // 広い
    "\xE4\xB8\xA1\xE7\xAB\xAF\xE6\x8F\x83\xE3\x81\x88", // 両端揃え
    "\xE5\xB7\xA6\xE6\x8F\x83\xE3\x81\x88",             // 左揃え
    "\xE4\xB8\xAD\xE5\xA4\xAE\xE6\x8F\x83\xE3\x81\x88", // 中央揃え
    "\xE5\x8F\xB3\xE6\x8F\x83\xE3\x81\x88",             // 右揃え
    "1\xE5\x88\x86",                                    // 1分
    "5\xE5\x88\x86",                                    // 5分
    "10\xE5\x88\x86",                                   // 10分
    "15\xE5\x88\x86",                                   // 15分
    "30\xE5\x88\x86",                                   // 30分
    "1\xE3\x83\x9A\xE3\x83\xBC\xE3\x82\xB8",            // 1ページ
    "5\xE3\x83\x9A\xE3\x83\xBC\xE3\x82\xB8",            // 5ページ
    "10\xE3\x83\x9A\xE3\x83\xBC\xE3\x82\xB8",           // 10ページ
    "15\xE3\x83\x9A\xE3\x83\xBC\xE3\x82\xB8",           // 15ページ
    "30\xE3\x83\x9A\xE3\x83\xBC\xE3\x82\xB8",           // 30ページ

    // OTA Update
    "\xE3\x82\xA2\xE3\x83\x83\xE3\x83\x97\xE3\x83\x87\xE3\x83\xBC\xE3"
    "\x83"
    "\x88", // アップデート
    "\xE3\x82\xA2\xE3\x83\x83\xE3\x83\x97\xE3\x83\x87\xE3\x83\xBC\xE3"
    "\x83"
    "\x88\xE3\x82\x92\xE7\xA2\xBA\xE8\xAA\x8D\xE4\xB8\xAD...", // アップデートを確認中...
    "\xE6\x96\xB0\xE3\x81\x97\xE3\x81\x84\xE3\x82\xA2\xE3\x83\x83\xE3"
    "\x83"
    "\x97\xE3\x83\x87\xE3\x83\xBC\xE3\x83\x88\xE3\x81\x8C\xE3\x81\x82"
    "\xE3"
    "\x82\x8A\xE3\x81\xBE\xE3\x81\x99!", // 新しいアップデートがあります!
    "\xE7\x8F\xBE\xE5\x9C\xA8\xE3\x81\xAE\xE3\x83\x90\xE3\x83\xBC\xE3"
    "\x82"
    "\xB8\xE3\x83\xA7\xE3\x83\xB3: ", // 現在のバージョン:
    "\xE6\x96\xB0\xE3\x83\x90\xE3\x83\xBC\xE3\x82\xB8\xE3\x83\xA7\xE3"
    "\x83"
    "\xB3: ", // 新バージョン:
    "\xE3\x82\xA2\xE3\x83\x83\xE3\x83\x97\xE3\x83\x87\xE3\x83\xBC\xE3"
    "\x83"
    "\x88\xE4\xB8\xAD...",                              // アップデート中...
    "\xE6\x9C\x80\xE6\x96\xB0\xE3\x81\xA7\xE3\x81\x99", // 最新です
    "\xE3\x82\xA2\xE3\x83\x83\xE3\x83\x97\xE3\x83\x87\xE3\x83\xBC\xE3"
    "\x83"
    "\x88\xE5\xA4\xB1\xE6\x95\x97", // アップデート失敗
    "\xE3\x82\xA2\xE3\x83\x83\xE3\x83\x97\xE3\x83\x87\xE3\x83\xBC\xE3"
    "\x83"
    "\x88\xE5\xAE\x8C\xE4\xBA\x86", // アップデート完了
    "\xE9\x9B\xBB\xE6\xBA\x90\xE3\x83\x9C\xE3\x82\xBF\xE3\x83\xB3\xE3"
    "\x82"
    "\x92\xE9\x95\xB7\xE6\x8A\xBC\xE3\x81\x97\xE3\x81\x97\xE3\x81\xA6"
    "\xE9"
    "\x9B\xBB\xE6\xBA\x90ON", // 電源ボタンを長押しして電源ON

    // Font Selection
    "\xE5\xA4\x96\xE9\x83\xA8\xE3\x83\x95\xE3\x82\xA9\xE3\x83\xB3\xE3"
    "\x83"
    "\x88",                                               // 外部フォント
    "\xE5\x86\x85\xE8\x94\xB5(\xE7\x84\xA1\xE5\x8A\xB9)", // 内蔵(無効)

    // OPDS Browser
    "\xE3\x82\xA8\xE3\x83\xB3\xE3\x83\x88\xE3\x83\xAA\xE3\x81\x8C\xE8\xA6"
    "\x8B\xE3\x81\xA4\xE3\x81\x8B\xE3\x82\x8A\xE3\x81\xBE\xE3\x81\x9B\xE3"
    "\x82\x93", // エントリが見つかりません
    "\xE3\x83\x80\xE3\x83\xA6\xE3\x83\xB3\xE3\x83\xAD\xE3\x83\xBC\xE3\x83"
    "\x89\xE4\xB8\xAD...",                   // ダウンロード中...
    "\xE3\x82\xA8\xE3\x83\xA9\xE3\x83\xBC:", // エラー:
    "\xE7\x84\xA1\xE9\xA1\x8C",              // 無題
    "\xE3\x83\x8D\xE3\x83\x83\xE3\x83\x88\xE3\x83\xAF\xE3\x83\xBC\xE3\x82"
    "\xAF: ",                                               // ネットワーク:
    "IP\xE3\x82\xA2\xE3\x83\x89\xE3\x83\xAC\xE3\x82\xB9: ", // IPアドレス:
    "\xE3\x82\xB9\xE3\x83\x9E\xE3\x83\x9B\xE3\x81\xA7QR\xE3\x82\xB3\xE3\x83"
    "\xBC\xE3\x83\x89\xE3\x82\x92\xE3\x82\xB9\xE3\x82\xAD\xE3\x83\xA3\xE3"
    "\x83\xB3\xE3\x81\x97\xE3\x81\xA6WiFi\xE3\x81\xAB\xE6\x8E\xA5\xE7\xB6"
    "\x9A", // スマホでQRコードをスキャンしてWiFiに接続

    // Buttons
    "\xC2\xAB \xE6\x88\xBB\xE3\x82\x8B",                            // « 戻る
    "\xC2\xAB \xE7\xB5\x82\xE4\xBA\x86",                            // « 終了
    "\xC2\xAB \xE3\x83\x9B\xE3\x83\xBC\xE3\x83\xA0",                // « ホーム
    "\xC2\xAB \xE4\xBF\x9D\xE5\xAD\x98",                            // « 保存
    "\xE9\x81\xB8\xE6\x8A\x9E",                                     // 選択
    "\xE5\x88\x87\xE6\x9B\xBF",                                     // 切替
    "\xE7\xA2\xBA\xE8\xAA\x8D",                                     // 確認
    "\xE3\x82\xAD\xE3\x83\xA3\xE3\x83\xB3\xE3\x82\xBB\xE3\x83\xAB", // キャンセル
    "\xE6\x8E\xA5\xE7\xB6\x9A",                                     // 接続
    "\xE9\x96\x8B\xE3\x81\x8F",                                     // 開く
    "\xE5\x86\x8D\xE8\xA9\xA6\xE8\xA1\x8C",                         // 再試行
    "\xE3\x81\xAF\xE3\x81\x84",                                     // はい
    "\xE3\x81\x84\xE3\x81\x84\xE3\x81\x88",                         // いいえ
    "ON", "OFF",

    // Languages
    "English",
    "\xE4\xB8\xAD\xE6\x96\x87",             // 中文
    "\xE6\x97\xA5\xE6\x9C\xAC\xE8\xAA\x9E", // 日本語
};

// Compile-time check for array sizes
static_assert(sizeof(I18n::STRINGS_EN) / sizeof(I18n::STRINGS_EN[0]) ==
                  static_cast<size_t>(StrId::_COUNT),
              "STRINGS_EN size mismatch");
static_assert(sizeof(I18n::STRINGS_ZH) / sizeof(I18n::STRINGS_ZH[0]) ==
                  static_cast<size_t>(StrId::_COUNT),
              "STRINGS_ZH size mismatch");
static_assert(sizeof(I18n::STRINGS_JA) / sizeof(I18n::STRINGS_JA[0]) ==
                  static_cast<size_t>(StrId::_COUNT),
              "STRINGS_JA size mismatch");

const char *I18n::get(StrId id) const {
  const auto index = static_cast<size_t>(id);
  if (index >= static_cast<size_t>(StrId::_COUNT)) {
    return "???";
  }

  switch (_language) {
  case Language::CHINESE:
    return STRINGS_ZH[index];
  case Language::JAPANESE:
    return STRINGS_JA[index];
  case Language::ENGLISH:
  default:
    return STRINGS_EN[index];
  }
}

void I18n::setLanguage(Language lang) {
  if (lang >= Language::_COUNT) {
    return;
  }
  _language = lang;
  saveSettings();
}

void I18n::saveSettings() {
  SdMan.mkdir("/.crosspoint");

  FsFile file;
  if (!SdMan.openFileForWrite("I18N", SETTINGS_FILE, file)) {
    Serial.printf("[I18N] Failed to save settings\n");
    return;
  }

  serialization::writePod(file, SETTINGS_VERSION);
  serialization::writePod(file, static_cast<uint8_t>(_language));

  file.close();
  Serial.printf("[I18N] Settings saved: language=%d\n",
                static_cast<int>(_language));
}

void I18n::loadSettings() {
  FsFile file;
  if (!SdMan.openFileForRead("I18N", SETTINGS_FILE, file)) {
    Serial.printf("[I18N] No settings file, using default (English)\n");
    return;
  }

  uint8_t version;
  serialization::readPod(file, version);
  if (version != SETTINGS_VERSION) {
    Serial.printf("[I18N] Settings version mismatch\n");
    file.close();
    return;
  }

  uint8_t lang;
  serialization::readPod(file, lang);
  if (lang < static_cast<uint8_t>(Language::_COUNT)) {
    _language = static_cast<Language>(lang);
    Serial.printf("[I18N] Loaded language: %d\n", static_cast<int>(_language));
  }

  file.close();
}

// Generate character set for a specific language
const char *I18n::getCharacterSet(Language lang) {
  static std::string charsetEN;
  static std::string charsetZH;
  static std::string charsetJA;

  const char *const *strings;
  std::string *charset;

  switch (lang) {
  case Language::CHINESE:
    strings = STRINGS_ZH;
    charset = &charsetZH;
    break;
  case Language::JAPANESE:
    strings = STRINGS_JA;
    charset = &charsetJA;
    break;
  case Language::ENGLISH:
  default:
    strings = STRINGS_EN;
    charset = &charsetEN;
    break;
  }

  // Only generate once
  if (!charset->empty()) {
    return charset->c_str();
  }

  std::set<uint32_t> uniqueChars;

  // Iterate through all strings
  for (size_t i = 0; i < static_cast<size_t>(StrId::_COUNT); i++) {
    const char *str = strings[i];
    while (*str) {
      // Decode UTF-8
      uint32_t cp = 0;
      uint8_t b = static_cast<uint8_t>(*str);

      if ((b & 0x80) == 0) {
        // ASCII
        cp = b;
        str++;
      } else if ((b & 0xE0) == 0xC0) {
        // 2-byte UTF-8
        cp = (b & 0x1F) << 6;
        cp |= (static_cast<uint8_t>(str[1]) & 0x3F);
        str += 2;
      } else if ((b & 0xF0) == 0xE0) {
        // 3-byte UTF-8
        cp = (b & 0x0F) << 12;
        cp |= (static_cast<uint8_t>(str[1]) & 0x3F) << 6;
        cp |= (static_cast<uint8_t>(str[2]) & 0x3F);
        str += 3;
      } else if ((b & 0xF8) == 0xF0) {
        // 4-byte UTF-8
        cp = (b & 0x07) << 18;
        cp |= (static_cast<uint8_t>(str[1]) & 0x3F) << 12;
        cp |= (static_cast<uint8_t>(str[2]) & 0x3F) << 6;
        cp |= (static_cast<uint8_t>(str[3]) & 0x3F);
        str += 4;
      } else {
        str++; // Invalid byte, skip
        continue;
      }

      uniqueChars.insert(cp);
    }
  }

  // Convert to sorted UTF-8 string
  for (uint32_t cp : uniqueChars) {
    if (cp < 0x80) {
      *charset += static_cast<char>(cp);
    } else if (cp < 0x800) {
      *charset += static_cast<char>(0xC0 | (cp >> 6));
      *charset += static_cast<char>(0x80 | (cp & 0x3F));
    } else if (cp < 0x10000) {
      *charset += static_cast<char>(0xE0 | (cp >> 12));
      *charset += static_cast<char>(0x80 | ((cp >> 6) & 0x3F));
      *charset += static_cast<char>(0x80 | (cp & 0x3F));
    } else {
      *charset += static_cast<char>(0xF0 | (cp >> 18));
      *charset += static_cast<char>(0x80 | ((cp >> 12) & 0x3F));
      *charset += static_cast<char>(0x80 | ((cp >> 6) & 0x3F));
      *charset += static_cast<char>(0x80 | (cp & 0x3F));
    }
  }

  return charset->c_str();
}
